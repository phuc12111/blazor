@page "/add-observation-signal"
@using System.Net.Http
@using Newtonsoft.Json
@using System.Threading.Tasks

<h3>Add Observation Signal</h3>

<form @onsubmit="HandleSubmit">
    <label for="type">Type:</label>
    <input type="text" id="type" @bind="observationSignal.Type" />

    <label for="code">Code:</label>
    <input type="text" id="code" @bind="observationSignal.Code" />

    <label for="value">Value:</label>
    <input type="text" id="value" @bind="observationSignal.Value" />

    <label for="unit">Unit:</label>
    <input type="text" id="unit" @bind="observationSignal.Unit" />

    <label for="encounter">Encounter:</label>
    <input type="number" id="encounter" @bind="observationSignal.Encounter" />

    <label for="request">Request:</label>
    <input type="number" id="request" @bind="observationSignal.Request" />

    <label for="division">Division:</label>
    <input type="number" id="division" @bind="observationSignal.Division" />

    <button type="submit">Submit</button>
</form>

@code {
    private HttpClient httpClient = new HttpClient();
    private ObservationSignal observationSignal = new ObservationSignal();

    private async Task HandleSubmit()
    {
        try
        {
            var json = JsonConvert.SerializeObject(observationSignal);
            var content = new StringContent(json, System.Text.Encoding.UTF8, "application/json");

            var response = await httpClient.PostAsync("http://14.241.182.251:59325/api/observation/signal", content);
            response.EnsureSuccessStatusCode();

            var responseContent = await response.Content.ReadAsStringAsync();
            Console.WriteLine(responseContent);

            // Reset form after successful submission
            observationSignal = new ObservationSignal();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"An error occurred: {ex.Message}");
        }
    }

    public class ObservationSignal
    {
        public string Type { get; set; }
        public string Code { get; set; }
        public string Value { get; set; }
        public string Unit { get; set; }
        public int Encounter { get; set; }
        public int Request { get; set; }
        public int Division { get; set; }
    }
}
